{"remainingRequest":"/Users/junronngcai/Downloads/vue3-json-schema-form/node_modules/babel-loader/lib/index.js!/Users/junronngcai/Downloads/vue3-json-schema-form/node_modules/ts-loader/index.js??ref--14-2!/Users/junronngcai/Downloads/vue3-json-schema-form/node_modules/eslint-loader/index.js??ref--13-0!/Users/junronngcai/Downloads/vue3-json-schema-form/lib/utils.ts","dependencies":[{"path":"/Users/junronngcai/Downloads/vue3-json-schema-form/lib/utils.ts","mtime":1608516377730},{"path":"/Users/junronngcai/Downloads/vue3-json-schema-form/node_modules/cache-loader/dist/cjs.js","mtime":1607437832202},{"path":"/Users/junronngcai/Downloads/vue3-json-schema-form/node_modules/babel-loader/lib/index.js","mtime":1608516392415},{"path":"/Users/junronngcai/Downloads/vue3-json-schema-form/node_modules/ts-loader/index.js","mtime":1608516394013},{"path":"/Users/junronngcai/Downloads/vue3-json-schema-form/node_modules/eslint-loader/index.js","mtime":1607437999134}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZXZlcnkiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maWx0ZXIiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5maW5kIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5mcm9tIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuaW5jbHVkZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5yZWR1Y2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zbGljZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC5rZXlzIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMub2JqZWN0LnRvLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnNldCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pbmNsdWRlcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5pdGVyYXRvciI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zdGFydHMtd2l0aCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL3dlYi5kb20tY29sbGVjdGlvbnMuZm9yLWVhY2giOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy93ZWIuZG9tLWNvbGxlY3Rpb25zLml0ZXJhdG9yIjsKaW1wb3J0IF9kZWZpbmVQcm9wZXJ0eSBmcm9tICIvVXNlcnMvanVucm9ubmdjYWkvRG93bmxvYWRzL3Z1ZTMtanNvbi1zY2hlbWEtZm9ybS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vZGVmaW5lUHJvcGVydHkiOwppbXBvcnQgX3RvQ29uc3VtYWJsZUFycmF5IGZyb20gIi9Vc2Vycy9qdW5yb25uZ2NhaS9Eb3dubG9hZHMvdnVlMy1qc29uLXNjaGVtYS1mb3JtL25vZGVfbW9kdWxlcy9AYmFiZWwvcnVudGltZS9oZWxwZXJzL2VzbS90b0NvbnN1bWFibGVBcnJheSI7CmltcG9ydCBfdG9Qcm9wZXJ0eUtleSBmcm9tICIvVXNlcnMvanVucm9ubmdjYWkvRG93bmxvYWRzL3Z1ZTMtanNvbi1zY2hlbWEtZm9ybS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdG9Qcm9wZXJ0eUtleSI7CmltcG9ydCBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMgZnJvbSAiL1VzZXJzL2p1bnJvbm5nY2FpL0Rvd25sb2Fkcy92dWUzLWpzb24tc2NoZW1hLWZvcm0vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzIjsKaW1wb3J0IF9vYmplY3RTcHJlYWQgZnJvbSAiL1VzZXJzL2p1bnJvbm5nY2FpL0Rvd25sb2Fkcy92dWUzLWpzb24tc2NoZW1hLWZvcm0vbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL29iamVjdFNwcmVhZDIiOwppbXBvcnQgX3R5cGVvZiBmcm9tICIvVXNlcnMvanVucm9ubmdjYWkvRG93bmxvYWRzL3Z1ZTMtanNvbi1zY2hlbWEtZm9ybS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdHlwZW9mIjsKaW1wb3J0IEFqdiBmcm9tICdhanYnOwppbXBvcnQganNvbnBvaW50ZXIgZnJvbSAnanNvbnBvaW50ZXInOwppbXBvcnQgdW5pb24gZnJvbSAnbG9kYXNoLnVuaW9uJzsKaW1wb3J0IG1lcmdlQWxsT2YgZnJvbSAnanNvbi1zY2hlbWEtbWVyZ2UtYWxsb2YnOwpleHBvcnQgZnVuY3Rpb24gaXNPYmplY3QodGhpbmcpIHsKICByZXR1cm4gX3R5cGVvZih0aGluZykgPT09ICdvYmplY3QnICYmIHRoaW5nICE9PSBudWxsICYmICFBcnJheS5pc0FycmF5KHRoaW5nKTsKfQpleHBvcnQgZnVuY3Rpb24gaXNFbXB0eU9iamVjdCh0aGluZykgewogIHJldHVybiBpc09iamVjdCh0aGluZykgJiYgT2JqZWN0LmtleXModGhpbmcpLmxlbmd0aCA9PT0gMDsKfQpleHBvcnQgZnVuY3Rpb24gaGFzT3duUHJvcGVydHkob2JqLCBrZXkpIHsKICAvKioKICAgKiDnm7TmjqXosIPnlKhgb2JqLmhhc093blByb3BlcnR5YOacieWPr+iDveS8muWboOS4ugogICAqIG9iaiDopobnm5bkuoYgcHJvdG90eXBlIOS4iueahCBoYXNPd25Qcm9wZXJ0eSDogIzkuqfnlJ/plJnor68KICAgKi8KICByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KTsKfSAvLyBpbXBvcnQgeyBpc09iamVjdCwgaGFzT3duUHJvcGVydHksIGdldFNjaGVtYVR5cGUsIGd1ZXNzVHlwZSB9IGZyb20gJy4vdXRpbHMnCi8vIGltcG9ydCB7IHZhbGlkYXRlRGF0YSB9IGZyb20gJy4vdmFsaWRhdG9yJwovLyBUT0RPOiDlupTor6Xot59TY2hlbWFGb3Jt55qEaW5zdGFuY2Xkv53mjIHkuIDoh7QKCnZhciBkZWZhdWx0SW5zdGFuY2UgPSBuZXcgQWp2KCk7CmV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZURhdGEoc2NoZW1hLCBkYXRhKSB7CiAgdmFyIHZhbGlkID0gZGVmYXVsdEluc3RhbmNlLnZhbGlkYXRlKHNjaGVtYSwgZGF0YSk7CiAgcmV0dXJuIHsKICAgIHZhbGlkOiB2YWxpZCwKICAgIGVycm9yczogZGVmYXVsdEluc3RhbmNlLmVycm9ycwogIH07Cn0gLy8gZnVuY3Rpb24gcmVzb2x2ZVNjaGVtYShzY2hlbWE6IGFueSwgZGF0YTogYW55ID0ge30pIHt9CgpleHBvcnQgZnVuY3Rpb24gcmVzb2x2ZVNjaGVtYShzY2hlbWEpIHsKICB2YXIgcm9vdFNjaGVtYSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CiAgdmFyIGZvcm1EYXRhID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiB7fTsKCiAgaWYgKGhhc093blByb3BlcnR5KHNjaGVtYSwgJyRyZWYnKSkgewogICAgcmV0dXJuIHJlc29sdmVSZWZlcmVuY2Uoc2NoZW1hLCByb290U2NoZW1hLCBmb3JtRGF0YSk7CiAgfSBlbHNlIGlmIChoYXNPd25Qcm9wZXJ0eShzY2hlbWEsICdkZXBlbmRlbmNpZXMnKSkgewogICAgdmFyIHJlc29sdmVkU2NoZW1hID0gcmVzb2x2ZURlcGVuZGVuY2llcyhzY2hlbWEsIHJvb3RTY2hlbWEsIGZvcm1EYXRhKTsKICAgIHJldHVybiByZXRyaWV2ZVNjaGVtYShyZXNvbHZlZFNjaGVtYSwgcm9vdFNjaGVtYSwgZm9ybURhdGEpOwogIH0gZWxzZSBpZiAoaGFzT3duUHJvcGVydHkoc2NoZW1hLCAnYWxsT2YnKSAmJiBBcnJheS5pc0FycmF5KHNjaGVtYS5hbGxPZikpIHsKICAgIHJldHVybiBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHNjaGVtYSksIHt9LCB7CiAgICAgIGFsbE9mOiBzY2hlbWEuYWxsT2YubWFwKGZ1bmN0aW9uIChhbGxPZlN1YnNjaGVtYSkgewogICAgICAgIHJldHVybiByZXRyaWV2ZVNjaGVtYShhbGxPZlN1YnNjaGVtYSwgcm9vdFNjaGVtYSwgZm9ybURhdGEpOwogICAgICB9KQogICAgfSk7CiAgfSBlbHNlIHsKICAgIC8vIE5vICRyZWYgb3IgZGVwZW5kZW5jaWVzIGF0dHJpYnV0ZSBmb3VuZCwgcmV0dXJuaW5nIHRoZSBvcmlnaW5hbCBzY2hlbWEuCiAgICByZXR1cm4gc2NoZW1hOwogIH0KfQpleHBvcnQgZnVuY3Rpb24gcmV0cmlldmVTY2hlbWEoc2NoZW1hKSB7CiAgdmFyIHJvb3RTY2hlbWEgPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IHt9OwogIHZhciBmb3JtRGF0YSA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDoge307CgogIGlmICghaXNPYmplY3Qoc2NoZW1hKSkgewogICAgcmV0dXJuIHt9OwogIH0KCiAgdmFyIHJlc29sdmVkU2NoZW1hID0gcmVzb2x2ZVNjaGVtYShzY2hlbWEsIHJvb3RTY2hlbWEsIGZvcm1EYXRhKTsgLy8gVE9ETzogYWxsT2YgYW5kIGFkZGl0aW9uYWxQcm9wZXJ0aWVzIG5vdCBpbXBsZW1lbnRlZAoKICBpZiAoJ2FsbE9mJyBpbiBzY2hlbWEpIHsKICAgIHRyeSB7CiAgICAgIHJlc29sdmVkU2NoZW1hID0gbWVyZ2VBbGxPZihfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHJlc29sdmVkU2NoZW1hKSwge30sIHsKICAgICAgICBhbGxPZjogcmVzb2x2ZWRTY2hlbWEuYWxsT2YKICAgICAgfSkpOwogICAgfSBjYXRjaCAoZSkgewogICAgICBjb25zb2xlLndhcm4oJ2NvdWxkIG5vdCBtZXJnZSBzdWJzY2hlbWFzIGluIGFsbE9mOlxuJyArIGUpOwoKICAgICAgdmFyIF9yZXNvbHZlZFNjaGVtYSA9IHJlc29sdmVkU2NoZW1hLAogICAgICAgICAgYWxsT2YgPSBfcmVzb2x2ZWRTY2hlbWEuYWxsT2YsCiAgICAgICAgICByZXNvbHZlZFNjaGVtYVdpdGhvdXRBbGxPZiA9IF9vYmplY3RXaXRob3V0UHJvcGVydGllcyhfcmVzb2x2ZWRTY2hlbWEsIFsiYWxsT2YiXSk7CgogICAgICByZXR1cm4gcmVzb2x2ZWRTY2hlbWFXaXRob3V0QWxsT2Y7CiAgICB9CiAgfQoKICB2YXIgaGFzQWRkaXRpb25hbFByb3BlcnRpZXMgPSByZXNvbHZlZFNjaGVtYS5oYXNPd25Qcm9wZXJ0eSgnYWRkaXRpb25hbFByb3BlcnRpZXMnKSAmJiByZXNvbHZlZFNjaGVtYS5hZGRpdGlvbmFsUHJvcGVydGllcyAhPT0gZmFsc2U7CgogIGlmIChoYXNBZGRpdGlvbmFsUHJvcGVydGllcykgewogICAgLy8gcHV0IGZvcm1EYXRhIGV4aXN0aW5nIGFkZGl0aW9uYWwgcHJvcGVydGllcyBpbnRvIHNjaGVtYQogICAgcmV0dXJuIHN0dWJFeGlzdGluZ0FkZGl0aW9uYWxQcm9wZXJ0aWVzKHJlc29sdmVkU2NoZW1hLCByb290U2NoZW1hLCBmb3JtRGF0YSk7CiAgfQoKICByZXR1cm4gcmVzb2x2ZWRTY2hlbWE7Cn0KZXhwb3J0IHZhciBBRERJVElPTkFMX1BST1BFUlRZX0ZMQUcgPSAnX19hZGRpdGlvbmFsX3Byb3BlcnR5JzsgLy8gVGhpcyBmdW5jdGlvbiB3aWxsIGNyZWF0ZSBuZXcgInByb3BlcnRpZXMiIGl0ZW1zIGZvciBlYWNoIGtleSBpbiBvdXIgZm9ybURhdGEKCmV4cG9ydCBmdW5jdGlvbiBzdHViRXhpc3RpbmdBZGRpdGlvbmFsUHJvcGVydGllcyhzY2hlbWEpIHsKICB2YXIgcm9vdFNjaGVtYSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CiAgdmFyIGZvcm1EYXRhID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiB7fTsKICAvLyBDbG9uZSB0aGUgc2NoZW1hIHNvIHdlIGRvbid0IHJ1aW4gdGhlIGNvbnN1bWVyJ3Mgb3JpZ2luYWwKICBzY2hlbWEgPSBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHNjaGVtYSksIHt9LCB7CiAgICBwcm9wZXJ0aWVzOiBfb2JqZWN0U3ByZWFkKHt9LCBzY2hlbWEucHJvcGVydGllcykKICB9KTsKICBPYmplY3Qua2V5cyhmb3JtRGF0YSkuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7CiAgICBpZiAoc2NoZW1hLnByb3BlcnRpZXMuaGFzT3duUHJvcGVydHkoa2V5KSkgewogICAgICAvLyBObyBuZWVkIHRvIHN0dWIsIG91ciBzY2hlbWEgYWxyZWFkeSBoYXMgdGhlIHByb3BlcnR5CiAgICAgIHJldHVybjsKICAgIH0KCiAgICB2YXIgYWRkaXRpb25hbFByb3BlcnRpZXM7CgogICAgaWYgKHNjaGVtYS5hZGRpdGlvbmFsUHJvcGVydGllcy5oYXNPd25Qcm9wZXJ0eSgnJHJlZicpKSB7CiAgICAgIGFkZGl0aW9uYWxQcm9wZXJ0aWVzID0gcmV0cmlldmVTY2hlbWEoewogICAgICAgICRyZWY6IHNjaGVtYS5hZGRpdGlvbmFsUHJvcGVydGllc1snJHJlZiddCiAgICAgIH0sIHJvb3RTY2hlbWEsIGZvcm1EYXRhKTsKICAgIH0gZWxzZSBpZiAoc2NoZW1hLmFkZGl0aW9uYWxQcm9wZXJ0aWVzLmhhc093blByb3BlcnR5KCd0eXBlJykpIHsKICAgICAgYWRkaXRpb25hbFByb3BlcnRpZXMgPSBfb2JqZWN0U3ByZWFkKHt9LCBzY2hlbWEuYWRkaXRpb25hbFByb3BlcnRpZXMpOwogICAgfSBlbHNlIHsKICAgICAgYWRkaXRpb25hbFByb3BlcnRpZXMgPSB7CiAgICAgICAgdHlwZTogZ3Vlc3NUeXBlKGZvcm1EYXRhW2tleV0pCiAgICAgIH07CiAgICB9IC8vIFRoZSB0eXBlIG9mIG91ciBuZXcga2V5IHNob3VsZCBtYXRjaCB0aGUgYWRkaXRpb25hbFByb3BlcnRpZXMgdmFsdWU7CgoKICAgIDsKICAgIHNjaGVtYS5wcm9wZXJ0aWVzW2tleV0gPSBhZGRpdGlvbmFsUHJvcGVydGllczsKICAgIHNjaGVtYS5wcm9wZXJ0aWVzW2tleV1bQURESVRJT05BTF9QUk9QRVJUWV9GTEFHXSA9IHRydWU7CiAgfSk7CiAgcmV0dXJuIHNjaGVtYTsKfSAvLyBleHBvcnQgZnVuY3Rpb24gcHJvY2Vzc1NjaGVtYSgKLy8gICBzY2hlbWE6IGFueSwKLy8gICByb290U2NoZW1hOiBhbnkgPSB7fSwKLy8gICBkYXRhOiBhbnkgPSB7fQovLyApOiBTY2hlbWEgewovLyAgIGlmIChoYXNPd25Qcm9wZXJ0eShzY2hlbWEsICckcmVmJykpIHsKLy8gICAgIHJldHVybiByZXNvbHZlUmVmZXJlbmNlKHNjaGVtYSwgcm9vdFNjaGVtYSwgZGF0YSkKLy8gICB9Ci8vICAgaWYgKGhhc093blByb3BlcnR5KHNjaGVtYSwgJ2RlcGVuZGVuY2llcycpKSB7Ci8vICAgICBjb25zdCByZXNvbHZlZFNjaGVtYSA9IHJlc29sdmVTY2hlbWEoc2NoZW1hKQovLyAgIH0KLy8gfQoKZnVuY3Rpb24gcmVzb2x2ZVJlZmVyZW5jZShzY2hlbWEsIHJvb3RTY2hlbWEsIGZvcm1EYXRhKSB7CiAgLy8gUmV0cmlldmUgdGhlIHJlZmVyZW5jZWQgc2NoZW1hIGRlZmluaXRpb24uCiAgdmFyICRyZWZTY2hlbWEgPSBmaW5kU2NoZW1hRGVmaW5pdGlvbihzY2hlbWEuJHJlZiwgcm9vdFNjaGVtYSk7IC8vIERyb3AgdGhlICRyZWYgcHJvcGVydHkgb2YgdGhlIHNvdXJjZSBzY2hlbWEuCgogIHZhciAkcmVmID0gc2NoZW1hLiRyZWYsCiAgICAgIGxvY2FsU2NoZW1hID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKHNjaGVtYSwgWyIkcmVmIl0pOyAvLyBVcGRhdGUgcmVmZXJlbmNlZCBzY2hlbWEgZGVmaW5pdGlvbiB3aXRoIGxvY2FsIHNjaGVtYSBwcm9wZXJ0aWVzLgoKCiAgcmV0dXJuIHJldHJpZXZlU2NoZW1hKF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgJHJlZlNjaGVtYSksIGxvY2FsU2NoZW1hKSwgcm9vdFNjaGVtYSwgZm9ybURhdGEpOwp9CgpleHBvcnQgZnVuY3Rpb24gZmluZFNjaGVtYURlZmluaXRpb24oJHJlZikgewogIHZhciByb290U2NoZW1hID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsKICB2YXIgb3JpZ1JlZiA9ICRyZWY7CgogIGlmICgkcmVmLnN0YXJ0c1dpdGgoJyMnKSkgewogICAgLy8gRGVjb2RlIFVSSSBmcmFnbWVudCByZXByZXNlbnRhdGlvbi4KICAgICRyZWYgPSBkZWNvZGVVUklDb21wb25lbnQoJHJlZi5zdWJzdHJpbmcoMSkpOwogIH0gZWxzZSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoIkNvdWxkIG5vdCBmaW5kIGEgZGVmaW5pdGlvbiBmb3IgIi5jb25jYXQob3JpZ1JlZiwgIi4iKSk7CiAgfQoKICB2YXIgY3VycmVudCA9IGpzb25wb2ludGVyLmdldChyb290U2NoZW1hLCAkcmVmKTsKCiAgaWYgKGN1cnJlbnQgPT09IHVuZGVmaW5lZCkgewogICAgdGhyb3cgbmV3IEVycm9yKCJDb3VsZCBub3QgZmluZCBhIGRlZmluaXRpb24gZm9yICIuY29uY2F0KG9yaWdSZWYsICIuIikpOwogIH0KCiAgaWYgKGhhc093blByb3BlcnR5KGN1cnJlbnQsICckcmVmJykpIHsKICAgIC8vIHJldHVybiB7IC4uLmN1cnJlbnQsIGZpbmRTY2hlbWFEZWZpbml0aW9uKGN1cnJlbnQuJHJlZiwgcm9vdFNjaGVtYSkgfSAgPwogICAgcmV0dXJuIGZpbmRTY2hlbWFEZWZpbml0aW9uKGN1cnJlbnQuJHJlZiwgcm9vdFNjaGVtYSk7CiAgfQoKICByZXR1cm4gY3VycmVudDsKfQoKZnVuY3Rpb24gcmVzb2x2ZURlcGVuZGVuY2llcyhzY2hlbWEsIHJvb3RTY2hlbWEsIGZvcm1EYXRhKSB7CiAgLy8gRHJvcCB0aGUgZGVwZW5kZW5jaWVzIGZyb20gdGhlIHNvdXJjZSBzY2hlbWEuCiAgdmFyIF9zY2hlbWEkZGVwZW5kZW5jaWVzID0gc2NoZW1hLmRlcGVuZGVuY2llcywKICAgICAgZGVwZW5kZW5jaWVzID0gX3NjaGVtYSRkZXBlbmRlbmNpZXMgPT09IHZvaWQgMCA/IHt9IDogX3NjaGVtYSRkZXBlbmRlbmNpZXMsCiAgICAgIHJlc29sdmVkU2NoZW1hID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKHNjaGVtYSwgWyJkZXBlbmRlbmNpZXMiXSk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUKCgogIGlmICgnb25lT2YnIGluIHJlc29sdmVkU2NoZW1hKSB7CiAgICByZXNvbHZlZFNjaGVtYSA9IHJlc29sdmVkU2NoZW1hLm9uZU9mW2dldE1hdGNoaW5nT3B0aW9uKGZvcm1EYXRhLCByZXNvbHZlZFNjaGVtYS5vbmVPZiwgcm9vdFNjaGVtYSldOwogIH0gZWxzZSBpZiAoJ2FueU9mJyBpbiByZXNvbHZlZFNjaGVtYSkgewogICAgcmVzb2x2ZWRTY2hlbWEgPSByZXNvbHZlZFNjaGVtYS5hbnlPZltnZXRNYXRjaGluZ09wdGlvbihmb3JtRGF0YSwgcmVzb2x2ZWRTY2hlbWEuYW55T2YsIHJvb3RTY2hlbWEpXTsKICB9CgogIHJldHVybiBwcm9jZXNzRGVwZW5kZW5jaWVzKGRlcGVuZGVuY2llcywgcmVzb2x2ZWRTY2hlbWEsIHJvb3RTY2hlbWEsIGZvcm1EYXRhKTsKfQoKZnVuY3Rpb24gcHJvY2Vzc0RlcGVuZGVuY2llcyhkZXBlbmRlbmNpZXMsIHJlc29sdmVkU2NoZW1hLCByb290U2NoZW1hLCBmb3JtRGF0YSkgewogIC8vIFByb2Nlc3MgZGVwZW5kZW5jaWVzIHVwZGF0aW5nIHRoZSBsb2NhbCBzY2hlbWEgcHJvcGVydGllcyBhcyBhcHByb3ByaWF0ZS4KICBmb3IgKHZhciBkZXBlbmRlbmN5S2V5IGluIGRlcGVuZGVuY2llcykgewogICAgLy8gU2tpcCB0aGlzIGRlcGVuZGVuY3kgaWYgaXRzIHRyaWdnZXIgcHJvcGVydHkgaXMgbm90IHByZXNlbnQuCiAgICBpZiAoZm9ybURhdGFbZGVwZW5kZW5jeUtleV0gPT09IHVuZGVmaW5lZCkgewogICAgICBjb250aW51ZTsKICAgIH0gLy8gU2tpcCB0aGlzIGRlcGVuZGVuY3kgaWYgaXQgaXMgbm90IGluY2x1ZGVkIGluIHRoZSBzY2hlbWEgKHN1Y2ggYXMgd2hlbiBkZXBlbmRlbmN5S2V5IGlzIGl0c2VsZiBhIGhpZGRlbiBkZXBlbmRlbmN5LikKCgogICAgaWYgKHJlc29sdmVkU2NoZW1hLnByb3BlcnRpZXMgJiYgIShkZXBlbmRlbmN5S2V5IGluIHJlc29sdmVkU2NoZW1hLnByb3BlcnRpZXMpKSB7CiAgICAgIGNvbnRpbnVlOwogICAgfQoKICAgIHZhciBkZXBlbmRlbmN5VmFsdWUgPSBkZXBlbmRlbmNpZXNbZGVwZW5kZW5jeUtleV0sCiAgICAgICAgcmVtYWluaW5nRGVwZW5kZW5jaWVzID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKGRlcGVuZGVuY2llcywgW2RlcGVuZGVuY3lLZXldLm1hcChfdG9Qcm9wZXJ0eUtleSkpOwoKICAgIGlmIChBcnJheS5pc0FycmF5KGRlcGVuZGVuY3lWYWx1ZSkpIHsKICAgICAgcmVzb2x2ZWRTY2hlbWEgPSB3aXRoRGVwZW5kZW50UHJvcGVydGllcyhyZXNvbHZlZFNjaGVtYSwgZGVwZW5kZW5jeVZhbHVlKTsKICAgIH0gZWxzZSBpZiAoaXNPYmplY3QoZGVwZW5kZW5jeVZhbHVlKSkgewogICAgICByZXNvbHZlZFNjaGVtYSA9IHdpdGhEZXBlbmRlbnRTY2hlbWEocmVzb2x2ZWRTY2hlbWEsIHJvb3RTY2hlbWEsIGZvcm1EYXRhLCBkZXBlbmRlbmN5S2V5LCBkZXBlbmRlbmN5VmFsdWUpOwogICAgfQoKICAgIHJldHVybiBwcm9jZXNzRGVwZW5kZW5jaWVzKHJlbWFpbmluZ0RlcGVuZGVuY2llcywgcmVzb2x2ZWRTY2hlbWEsIHJvb3RTY2hlbWEsIGZvcm1EYXRhKTsKICB9CgogIHJldHVybiByZXNvbHZlZFNjaGVtYTsKfQoKZnVuY3Rpb24gd2l0aERlcGVuZGVudFByb3BlcnRpZXMoc2NoZW1hLCBhZGRpdGlvbmFsbHlSZXF1aXJlZCkgewogIGlmICghYWRkaXRpb25hbGx5UmVxdWlyZWQpIHsKICAgIHJldHVybiBzY2hlbWE7CiAgfQoKICB2YXIgcmVxdWlyZWQgPSBBcnJheS5pc0FycmF5KHNjaGVtYS5yZXF1aXJlZCkgPyBBcnJheS5mcm9tKG5ldyBTZXQoW10uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShzY2hlbWEucmVxdWlyZWQpLCBfdG9Db25zdW1hYmxlQXJyYXkoYWRkaXRpb25hbGx5UmVxdWlyZWQpKSkpIDogYWRkaXRpb25hbGx5UmVxdWlyZWQ7CiAgcmV0dXJuIF9vYmplY3RTcHJlYWQoX29iamVjdFNwcmVhZCh7fSwgc2NoZW1hKSwge30sIHsKICAgIHJlcXVpcmVkOiByZXF1aXJlZAogIH0pOwp9CgpmdW5jdGlvbiB3aXRoRGVwZW5kZW50U2NoZW1hKHNjaGVtYSwgcm9vdFNjaGVtYSwgZm9ybURhdGEsIGRlcGVuZGVuY3lLZXksIGRlcGVuZGVuY3lWYWx1ZSkgewogIC8vIHJldHJpZXZlU2NoZW1hCiAgdmFyIF9yZXRyaWV2ZVNjaGVtYSA9IHJldHJpZXZlU2NoZW1hKGRlcGVuZGVuY3lWYWx1ZSwgcm9vdFNjaGVtYSwgZm9ybURhdGEpLAogICAgICBvbmVPZiA9IF9yZXRyaWV2ZVNjaGVtYS5vbmVPZiwKICAgICAgZGVwZW5kZW50U2NoZW1hID0gX29iamVjdFdpdGhvdXRQcm9wZXJ0aWVzKF9yZXRyaWV2ZVNjaGVtYSwgWyJvbmVPZiJdKTsKCiAgc2NoZW1hID0gbWVyZ2VTY2hlbWFzKHNjaGVtYSwgZGVwZW5kZW50U2NoZW1hKTsgLy8gU2luY2UgaXQgZG9lcyBub3QgY29udGFpbiBvbmVPZiwgd2UgcmV0dXJuIHRoZSBvcmlnaW5hbCBzY2hlbWEuCgogIGlmIChvbmVPZiA9PT0gdW5kZWZpbmVkKSB7CiAgICByZXR1cm4gc2NoZW1hOwogIH0gZWxzZSBpZiAoIUFycmF5LmlzQXJyYXkob25lT2YpKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoImludmFsaWQ6IGl0IGlzIHNvbWUgIi5jb25jYXQoX3R5cGVvZihvbmVPZiksICIgaW5zdGVhZCBvZiBhbiBhcnJheSIpKTsKICB9IC8vIFJlc29sdmUgJHJlZnMgaW5zaWRlIG9uZU9mLgoKCiAgdmFyIHJlc29sdmVkT25lT2YgPSBvbmVPZi5tYXAoZnVuY3Rpb24gKHN1YnNjaGVtYSkgewogICAgcmV0dXJuIGhhc093blByb3BlcnR5KHN1YnNjaGVtYSwgJyRyZWYnKSA/IHJlc29sdmVSZWZlcmVuY2Uoc3Vic2NoZW1hLCByb290U2NoZW1hLCBmb3JtRGF0YSkgOiBzdWJzY2hlbWE7CiAgfSk7CiAgcmV0dXJuIHdpdGhFeGFjdGx5T25lU3Vic2NoZW1hKHNjaGVtYSwgcm9vdFNjaGVtYSwgZm9ybURhdGEsIGRlcGVuZGVuY3lLZXksIHJlc29sdmVkT25lT2YpOwp9CgpmdW5jdGlvbiB3aXRoRXhhY3RseU9uZVN1YnNjaGVtYShzY2hlbWEsIHJvb3RTY2hlbWEsIGZvcm1EYXRhLCBkZXBlbmRlbmN5S2V5LCBvbmVPZikgewogIHZhciB2YWxpZFN1YnNjaGVtYXMgPSBvbmVPZi5maWx0ZXIoZnVuY3Rpb24gKHN1YnNjaGVtYSkgewogICAgaWYgKCFzdWJzY2hlbWEucHJvcGVydGllcykgewogICAgICByZXR1cm4gZmFsc2U7CiAgICB9CgogICAgdmFyIGNvbmRpdGlvblByb3BlcnR5U2NoZW1hID0gc3Vic2NoZW1hLnByb3BlcnRpZXNbZGVwZW5kZW5jeUtleV07CgogICAgaWYgKGNvbmRpdGlvblByb3BlcnR5U2NoZW1hKSB7CiAgICAgIHZhciBjb25kaXRpb25TY2hlbWEgPSB7CiAgICAgICAgdHlwZTogJ29iamVjdCcsCiAgICAgICAgcHJvcGVydGllczogX2RlZmluZVByb3BlcnR5KHt9LCBkZXBlbmRlbmN5S2V5LCBjb25kaXRpb25Qcm9wZXJ0eVNjaGVtYSkKICAgICAgfTsgLy8gVE9ETzogdmFsaWRhdGUgZm9ybWRhdGEKCiAgICAgIHZhciBfdmFsaWRhdGVEYXRhID0gdmFsaWRhdGVEYXRhKGNvbmRpdGlvblNjaGVtYSwgZm9ybURhdGEpLAogICAgICAgICAgZXJyb3JzID0gX3ZhbGlkYXRlRGF0YS5lcnJvcnM7CgogICAgICByZXR1cm4gIWVycm9ycyB8fCBlcnJvcnMubGVuZ3RoID09PSAwOwogICAgfQogIH0pOwoKICBpZiAodmFsaWRTdWJzY2hlbWFzLmxlbmd0aCAhPT0gMSkgewogICAgY29uc29sZS53YXJuKCJpZ25vcmluZyBvbmVPZiBpbiBkZXBlbmRlbmNpZXMgYmVjYXVzZSB0aGVyZSBpc24ndCBleGFjdGx5IG9uZSBzdWJzY2hlbWEgdGhhdCBpcyB2YWxpZCIpOwogICAgcmV0dXJuIHNjaGVtYTsKICB9IC8vIGRlYnVnZ2VyCgoKICB2YXIgc3Vic2NoZW1hID0gdmFsaWRTdWJzY2hlbWFzWzBdOwoKICB2YXIgX3N1YnNjaGVtYSRwcm9wZXJ0aWVzID0gc3Vic2NoZW1hLnByb3BlcnRpZXMsCiAgICAgIGNvbmRpdGlvblByb3BlcnR5U2NoZW1hID0gX3N1YnNjaGVtYSRwcm9wZXJ0aWVzW2RlcGVuZGVuY3lLZXldLAogICAgICBkZXBlbmRlbnRTdWJzY2hlbWEgPSBfb2JqZWN0V2l0aG91dFByb3BlcnRpZXMoX3N1YnNjaGVtYSRwcm9wZXJ0aWVzLCBbZGVwZW5kZW5jeUtleV0ubWFwKF90b1Byb3BlcnR5S2V5KSk7CgogIHZhciBkZXBlbmRlbnRTY2hlbWEgPSBfb2JqZWN0U3ByZWFkKF9vYmplY3RTcHJlYWQoe30sIHN1YnNjaGVtYSksIHt9LCB7CiAgICBwcm9wZXJ0aWVzOiBkZXBlbmRlbnRTdWJzY2hlbWEKICB9KTsKCiAgcmV0dXJuIG1lcmdlU2NoZW1hcyhzY2hlbWEsIC8vIHJldHJpZXZlU2NoZW1hCiAgcmV0cmlldmVTY2hlbWEoZGVwZW5kZW50U2NoZW1hLCByb290U2NoZW1hLCBmb3JtRGF0YSkpOwp9IC8vIFJlY3Vyc2l2ZWx5IG1lcmdlIGRlZXBseSBuZXN0ZWQgc2NoZW1hcy4KLy8gVGhlIGRpZmZlcmVuY2UgYmV0d2VlbiBtZXJnZVNjaGVtYXMgYW5kIG1lcmdlT2JqZWN0cwovLyBpcyB0aGF0IG1lcmdlU2NoZW1hcyBvbmx5IGNvbmNhdHMgYXJyYXlzIGZvcgovLyB2YWx1ZXMgdW5kZXIgdGhlICJyZXF1aXJlZCIga2V5d29yZCwgYW5kIHdoZW4gaXQgZG9lcywKLy8gaXQgZG9lc24ndCBpbmNsdWRlIGR1cGxpY2F0ZSB2YWx1ZXMuCgoKZXhwb3J0IGZ1bmN0aW9uIG1lcmdlU2NoZW1hcyhvYmoxLCBvYmoyKSB7CiAgdmFyIGFjYyA9IE9iamVjdC5hc3NpZ24oe30sIG9iajEpOyAvLyBQcmV2ZW50IG11dGF0aW9uIG9mIHNvdXJjZSBvYmplY3QuCgogIHJldHVybiBPYmplY3Qua2V5cyhvYmoyKS5yZWR1Y2UoZnVuY3Rpb24gKGFjYywga2V5KSB7CiAgICB2YXIgbGVmdCA9IG9iajEgPyBvYmoxW2tleV0gOiB7fSwKICAgICAgICByaWdodCA9IG9iajJba2V5XTsKCiAgICBpZiAob2JqMSAmJiBoYXNPd25Qcm9wZXJ0eShvYmoxLCBrZXkpICYmIGlzT2JqZWN0KHJpZ2h0KSkgewogICAgICBhY2Nba2V5XSA9IG1lcmdlU2NoZW1hcyhsZWZ0LCByaWdodCk7CiAgICB9IGVsc2UgaWYgKG9iajEgJiYgb2JqMiAmJiAoZ2V0U2NoZW1hVHlwZShvYmoxKSA9PT0gJ29iamVjdCcgfHwgZ2V0U2NoZW1hVHlwZShvYmoyKSA9PT0gJ29iamVjdCcpICYmIGtleSA9PT0gJ3JlcXVpcmVkJyAmJiBBcnJheS5pc0FycmF5KGxlZnQpICYmIEFycmF5LmlzQXJyYXkocmlnaHQpKSB7CiAgICAgIC8vIERvbid0IGluY2x1ZGUgZHVwbGljYXRlIHZhbHVlcyB3aGVuIG1lcmdpbmcKICAgICAgLy8gInJlcXVpcmVkIiBmaWVsZHMuCiAgICAgIGFjY1trZXldID0gdW5pb24obGVmdCwgcmlnaHQpOwogICAgfSBlbHNlIHsKICAgICAgYWNjW2tleV0gPSByaWdodDsKICAgIH0KCiAgICByZXR1cm4gYWNjOwogIH0sIGFjYyk7Cn0gLy8gZXhwb3J0IGZ1bmN0aW9uIGdldFZKU0ZDb25maWcoCi8vICAgc2NoZW1hOiBTY2hlbWEsCi8vICAgdWlTY2hlbWE6IFZ1ZUpzb25TY2hlbWFDb25maWcgfCB1bmRlZmluZWQsCi8vICk6IFZ1ZUpzb25TY2hlbWFDb25maWcgewovLyAgIGlmICh1aVNjaGVtYSkgcmV0dXJuIHVpU2NoZW1hCi8vICAgcmV0dXJuIHNjaGVtYS52anNmIHx8IHt9Ci8vIH0KCi8qIEdldHMgdGhlIHR5cGUgb2YgYSBnaXZlbiBzY2hlbWEuICovCgpleHBvcnQgZnVuY3Rpb24gZ2V0U2NoZW1hVHlwZShzY2hlbWEpIHsKICB2YXIgdHlwZSA9IHNjaGVtYS50eXBlOwoKICBpZiAoIXR5cGUgJiYgc2NoZW1hLmNvbnN0KSB7CiAgICByZXR1cm4gZ3Vlc3NUeXBlKHNjaGVtYS5jb25zdCk7CiAgfQoKICBpZiAoIXR5cGUgJiYgc2NoZW1hLmVudW0pIHsKICAgIHJldHVybiAnc3RyaW5nJzsKICB9CgogIGlmICghdHlwZSAmJiAoc2NoZW1hLnByb3BlcnRpZXMgfHwgc2NoZW1hLmFkZGl0aW9uYWxQcm9wZXJ0aWVzKSkgewogICAgcmV0dXJuICdvYmplY3QnOwogIH0KCiAgdmFyIHQgPSB0eXBlOwoKICBpZiAodCBpbnN0YW5jZW9mIEFycmF5ICYmIHQubGVuZ3RoID09PSAyICYmIHQuaW5jbHVkZXMoJ251bGwnKSkgewogICAgcmV0dXJuIHQuZmluZChmdW5jdGlvbiAodHlwZSkgewogICAgICByZXR1cm4gdHlwZSAhPT0gJ251bGwnOwogICAgfSk7CiAgfQoKICByZXR1cm4gdHlwZTsgLy8gbGV0IHsgdHlwZSB9ID0gc2NoZW1hCiAgLy8gaWYgKHR5cGUpIHJldHVybiB0eXBlCiAgLy8gaWYgKCF0eXBlICYmIHNjaGVtYS5jb25zdCkgewogIC8vICAgcmV0dXJuIGd1ZXNzVHlwZShzY2hlbWEuY29uc3QpCiAgLy8gfQogIC8vIGlmICghdHlwZSAmJiBzY2hlbWEuZW51bSkgewogIC8vICAgLy8gcmV0dXJuICdzdHJpbmcnCiAgLy8gICByZXR1cm4gZ3Vlc3NUeXBlKHNjaGVtYS5lbnVtWzBdKQogIC8vIH0KICAvLyBpZiAoIXR5cGUgJiYgKHNjaGVtYS5wcm9wZXJ0aWVzIHx8IHNjaGVtYS5hZGRpdGlvbmFsUHJvcGVydGllcykpIHsKICAvLyAgIHJldHVybiAnb2JqZWN0JwogIC8vIH0KICAvLyBjb25zb2xlLndhcm4oJ2NhbiBub3QgZ3Vlc3Mgc2NoZW1hIHR5cGUsIGp1c3QgdXNlIG9iamVjdCcsIHNjaGVtYSkKICAvLyByZXR1cm4gJ29iamVjdCcKICAvLyBpZiAodHlwZSBpbnN0YW5jZW9mIEFycmF5ICYmIHR5cGUubGVuZ3RoID09PSAyICYmIHR5cGUuaW5jbHVkZXMoJ251bGwnKSkgewogIC8vICAgcmV0dXJuIHR5cGUuZmluZCgodHlwZSkgPT4gdHlwZSAhPT0gJ251bGwnKQogIC8vIH0KfSAvLyBJbiB0aGUgY2FzZSB3aGVyZSB3ZSBoYXZlIHRvIGltcGxpY2l0bHkgY3JlYXRlIGEgc2NoZW1hLCBpdCBpcyB1c2VmdWwgdG8ga25vdyB3aGF0IHR5cGUgdG8gdXNlCi8vICBiYXNlZCBvbiB0aGUgZGF0YSB3ZSBhcmUgZGVmaW5pbmcKCmV4cG9ydCB2YXIgZ3Vlc3NUeXBlID0gZnVuY3Rpb24gZ3Vlc3NUeXBlKHZhbHVlKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkodmFsdWUpKSB7CiAgICByZXR1cm4gJ2FycmF5JzsKICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHsKICAgIHJldHVybiAnc3RyaW5nJzsKICB9IGVsc2UgaWYgKHZhbHVlID09IG51bGwpIHsKICAgIHJldHVybiAnbnVsbCc7CiAgfSBlbHNlIGlmICh0eXBlb2YgdmFsdWUgPT09ICdib29sZWFuJykgewogICAgcmV0dXJuICdib29sZWFuJzsKICB9IGVsc2UgaWYgKCFpc05hTih2YWx1ZSkpIHsKICAgIHJldHVybiAnbnVtYmVyJzsKICB9IGVsc2UgaWYgKF90eXBlb2YodmFsdWUpID09PSAnb2JqZWN0JykgewogICAgcmV0dXJuICdvYmplY3QnOwogIH0gLy8gRGVmYXVsdCB0byBzdHJpbmcgaWYgd2UgY2FuJ3QgZmlndXJlIGl0IG91dAoKCiAgcmV0dXJuICdzdHJpbmcnOwp9OwpleHBvcnQgZnVuY3Rpb24gaXNDb25zdGFudChzY2hlbWEpIHsKICByZXR1cm4gQXJyYXkuaXNBcnJheShzY2hlbWEuZW51bSkgJiYgc2NoZW1hLmVudW0ubGVuZ3RoID09PSAxIHx8IHNjaGVtYS5oYXNPd25Qcm9wZXJ0eSgnY29uc3QnKTsKfQpleHBvcnQgZnVuY3Rpb24gaXNTZWxlY3QoX3NjaGVtYSkgewogIHZhciByb290U2NoZW1hID0gYXJndW1lbnRzLmxlbmd0aCA+IDEgJiYgYXJndW1lbnRzWzFdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMV0gOiB7fTsKICB2YXIgc2NoZW1hID0gcmV0cmlldmVTY2hlbWEoX3NjaGVtYSwgcm9vdFNjaGVtYSk7CiAgdmFyIGFsdFNjaGVtYXMgPSBzY2hlbWEub25lT2YgfHwgc2NoZW1hLmFueU9mOwoKICBpZiAoQXJyYXkuaXNBcnJheShzY2hlbWEuZW51bSkpIHsKICAgIHJldHVybiB0cnVlOwogIH0gZWxzZSBpZiAoQXJyYXkuaXNBcnJheShhbHRTY2hlbWFzKSkgewogICAgcmV0dXJuIGFsdFNjaGVtYXMuZXZlcnkoZnVuY3Rpb24gKGFsdFNjaGVtYXMpIHsKICAgICAgcmV0dXJuIGlzQ29uc3RhbnQoYWx0U2NoZW1hcyk7CiAgICB9KTsKICB9CgogIHJldHVybiBmYWxzZTsKfQpleHBvcnQgZnVuY3Rpb24gaXNNdWx0aVNlbGVjdChzY2hlbWEpIHsKICB2YXIgcm9vdFNjaGVtYSA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDoge307CgogIGlmICghc2NoZW1hLnVuaXF1ZUl0ZW1zIHx8ICFzY2hlbWEuaXRlbXMpIHsKICAgIHJldHVybiBmYWxzZTsKICB9CgogIHJldHVybiBpc1NlbGVjdChzY2hlbWEuaXRlbXMsIHJvb3RTY2hlbWEpOwp9IC8vIFRPRE86IGNoYW5nZSBvbmVPZiBzZWxlY3RlZCBiYXNlZCBvbiBkYXRhCgpleHBvcnQgZnVuY3Rpb24gZ2V0TWF0Y2hpbmdPcHRpb24oZm9ybURhdGEsIG9wdGlvbnMsIGlzVmFsaWQpIHsKICBmb3IgKHZhciBpID0gMDsgaSA8IG9wdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgIHZhciBvcHRpb24gPSBvcHRpb25zW2ldOyAvLyBJZiB0aGUgc2NoZW1hIGRlc2NyaWJlcyBhbiBvYmplY3QgdGhlbiB3ZSBuZWVkIHRvIGFkZCBzbGlnaHRseSBtb3JlCiAgICAvLyBzdHJpY3QgbWF0Y2hpbmcgdG8gdGhlIHNjaGVtYSwgYmVjYXVzZSB1bmxlc3MgdGhlIHNjaGVtYSB1c2VzIHRoZQogICAgLy8gInJlcXVpcmVzIiBrZXl3b3JkLCBhbiBvYmplY3Qgd2lsbCBtYXRjaCB0aGUgc2NoZW1hIGFzIGxvbmcgYXMgaXQKICAgIC8vIGRvZXNuJ3QgaGF2ZSBtYXRjaGluZyBrZXlzIHdpdGggYSBjb25mbGljdGluZyB0eXBlLiBUbyBkbyB0aGlzIHdlIHVzZSBhbgogICAgLy8gImFueU9mIiB3aXRoIGFuIGFycmF5IG9mIHJlcXVpcmVzLiBUaGlzIGF1Z21lbnRhdGlvbiBleHByZXNzZXMgdGhhdCB0aGUKICAgIC8vIHNjaGVtYSBzaG91bGQgbWF0Y2ggaWYgYW55IG9mIHRoZSBrZXlzIGluIHRoZSBzY2hlbWEgYXJlIHByZXNlbnQgb24gdGhlCiAgICAvLyBvYmplY3QgYW5kIHBhc3MgdmFsaWRhdGlvbi4KCiAgICBpZiAob3B0aW9uLnByb3BlcnRpZXMpIHsKICAgICAgLy8gQ3JlYXRlIGFuICJhbnlPZiIgc2NoZW1hIHRoYXQgcmVxdWlyZXMgYXQgbGVhc3Qgb25lIG9mIHRoZSBrZXlzIGluIHRoZQogICAgICAvLyAicHJvcGVydGllcyIgb2JqZWN0CiAgICAgIHZhciByZXF1aXJlc0FueU9mID0gewogICAgICAgIGFueU9mOiBPYmplY3Qua2V5cyhvcHRpb24ucHJvcGVydGllcykubWFwKGZ1bmN0aW9uIChrZXkpIHsKICAgICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHJlcXVpcmVkOiBba2V5XQogICAgICAgICAgfTsKICAgICAgICB9KQogICAgICB9OwogICAgICB2YXIgYXVnbWVudGVkU2NoZW1hID0gdm9pZCAwOyAvLyBJZiB0aGUgImFueU9mIiBrZXl3b3JkIGFscmVhZHkgZXhpc3RzLCB3cmFwIHRoZSBhdWdtZW50YXRpb24gaW4gYW4gImFsbE9mIgoKICAgICAgaWYgKG9wdGlvbi5hbnlPZikgewogICAgICAgIC8vIENyZWF0ZSBhIHNoYWxsb3cgY2xvbmUgb2YgdGhlIG9wdGlvbgogICAgICAgIHZhciBzaGFsbG93Q2xvbmUgPSBPYmplY3QuYXNzaWduKHt9LCBvcHRpb24pOwoKICAgICAgICBpZiAoIXNoYWxsb3dDbG9uZS5hbGxPZikgewogICAgICAgICAgc2hhbGxvd0Nsb25lLmFsbE9mID0gW107CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIElmICJhbGxPZiIgYWxyZWFkeSBleGlzdHMsIHNoYWxsb3cgY2xvbmUgdGhlIGFycmF5CiAgICAgICAgICBzaGFsbG93Q2xvbmUuYWxsT2YgPSBzaGFsbG93Q2xvbmUuYWxsT2Yuc2xpY2UoKTsKICAgICAgICB9CgogICAgICAgIHNoYWxsb3dDbG9uZS5hbGxPZi5wdXNoKHJlcXVpcmVzQW55T2YpOwogICAgICAgIGF1Z21lbnRlZFNjaGVtYSA9IHNoYWxsb3dDbG9uZTsKICAgICAgfSBlbHNlIHsKICAgICAgICBhdWdtZW50ZWRTY2hlbWEgPSBPYmplY3QuYXNzaWduKHt9LCBvcHRpb24sIHJlcXVpcmVzQW55T2YpOwogICAgICB9IC8vIFJlbW92ZSB0aGUgInJlcXVpcmVkIiBmaWVsZCBhcyBpdCdzIGxpa2VseSB0aGF0IG5vdCBhbGwgZmllbGRzIGhhdmUKICAgICAgLy8gYmVlbiBmaWxsZWQgaW4geWV0LCB3aGljaCB3aWxsIG1lYW4gdGhhdCB0aGUgc2NoZW1hIGlzIG5vdCB2YWxpZAoKCiAgICAgIGRlbGV0ZSBhdWdtZW50ZWRTY2hlbWEucmVxdWlyZWQ7CgogICAgICBpZiAoaXNWYWxpZChhdWdtZW50ZWRTY2hlbWEsIGZvcm1EYXRhKSkgewogICAgICAgIHJldHVybiBpOwogICAgICB9CiAgICB9IGVsc2UgaWYgKGlzVmFsaWQob3B0aW9uc1tpXSwgZm9ybURhdGEpKSB7CiAgICAgIHJldHVybiBpOwogICAgfQogIH0KCiAgcmV0dXJuIDA7Cn0KZXhwb3J0IGZ1bmN0aW9uIG1lcmdlRGVmYXVsdHNXaXRoRm9ybURhdGEoZGVmYXVsdHMsIGZvcm1EYXRhKSB7CiAgaWYgKEFycmF5LmlzQXJyYXkoZm9ybURhdGEpKSB7CiAgICBpZiAoIUFycmF5LmlzQXJyYXkoZGVmYXVsdHMpKSB7CiAgICAgIGRlZmF1bHRzID0gW107CiAgICB9CgogICAgcmV0dXJuIGZvcm1EYXRhLm1hcChmdW5jdGlvbiAodmFsdWUsIGlkeCkgewogICAgICBpZiAoZGVmYXVsdHNbaWR4XSkgewogICAgICAgIHJldHVybiBtZXJnZURlZmF1bHRzV2l0aEZvcm1EYXRhKGRlZmF1bHRzW2lkeF0sIHZhbHVlKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHZhbHVlOwogICAgfSk7CiAgfSBlbHNlIGlmIChpc09iamVjdChmb3JtRGF0YSkpIHsKICAgIHZhciBhY2MgPSBPYmplY3QuYXNzaWduKHt9LCBkZWZhdWx0cyk7IC8vIFByZXZlbnQgbXV0YXRpb24gb2Ygc291cmNlIG9iamVjdC4KCiAgICByZXR1cm4gT2JqZWN0LmtleXMoZm9ybURhdGEpLnJlZHVjZShmdW5jdGlvbiAoYWNjLCBrZXkpIHsKICAgICAgYWNjW2tleV0gPSBtZXJnZURlZmF1bHRzV2l0aEZvcm1EYXRhKGRlZmF1bHRzID8gZGVmYXVsdHNba2V5XSA6IHt9LCBmb3JtRGF0YVtrZXldKTsKICAgICAgcmV0dXJuIGFjYzsKICAgIH0sIGFjYyk7CiAgfSBlbHNlIHsKICAgIHJldHVybiBmb3JtRGF0YTsKICB9Cn0KZXhwb3J0IGZ1bmN0aW9uIGdldERlZmF1bHRGb3JtU3RhdGUoX3NjaGVtYSwgZm9ybURhdGEpIHsKICBpZiAoIWlzT2JqZWN0KF9zY2hlbWEpKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgc2NoZW1hOiAnICsgX3NjaGVtYSk7CiAgfSAvLyBjb25zdCBzY2hlbWEgPSByZXRyaWV2ZVNjaGVtYShfc2NoZW1hLCByb290U2NoZW1hLCBmb3JtRGF0YSkKCgogIHZhciBkZWZhdWx0cyA9IF9zY2hlbWEuZGVmYXVsdDsgLy8gVE9ETzogSSBndWVzcyB3ZSBkb24ndCBuZWVkIHRvIGdldCBkZWZhdWx0IGZyb20gY2hpbGRyZW4gc2NoZW1hCiAgLy8gY29uc3QgZGVmYXVsdHMgPSBjb21wdXRlRGVmYXVsdHMoCiAgLy8gICBzY2hlbWEsCiAgLy8gICBfc2NoZW1hLmRlZmF1bHQsCiAgLy8gICByb290U2NoZW1hLAogIC8vICAgZm9ybURhdGEsCiAgLy8gICBpbmNsdWRlVW5kZWZpbmVkVmFsdWVzCiAgLy8gKTsKCiAgaWYgKHR5cGVvZiBmb3JtRGF0YSA9PT0gJ3VuZGVmaW5lZCcpIHsKICAgIC8vIE5vIGZvcm0gZGF0YT8gVXNlIHNjaGVtYSBkZWZhdWx0cy4KICAgIHJldHVybiBkZWZhdWx0czsKICB9CgogIGlmIChpc09iamVjdChmb3JtRGF0YSkgfHwgQXJyYXkuaXNBcnJheShmb3JtRGF0YSkpIHsKICAgIHJldHVybiBtZXJnZURlZmF1bHRzV2l0aEZvcm1EYXRhKGRlZmF1bHRzLCBmb3JtRGF0YSk7CiAgfQoKICBpZiAoZm9ybURhdGEgPT09IDAgfHwgZm9ybURhdGEgPT09IGZhbHNlIHx8IGZvcm1EYXRhID09PSAnJykgewogICAgcmV0dXJuIGZvcm1EYXRhOwogIH0KCiAgcmV0dXJuIGZvcm1EYXRhIHx8IGRlZmF1bHRzOwp9"},{"version":3,"sources":["/Users/junronngcai/Downloads/vue3-json-schema-form/node_modules/eslint-loader/index.js??ref--13-0!/Users/junronngcai/Downloads/vue3-json-schema-form/lib/utils.ts"],"names":[],"mappings":"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","sourcesContent":["import Ajv from 'ajv'\n\nimport { Schema } from './types'\n\nimport jsonpointer from 'jsonpointer'\nimport union from 'lodash.union'\nimport mergeAllOf from 'json-schema-merge-allof'\n\nexport function isObject(thing: any) {\n  return typeof thing === 'object' && thing !== null && !Array.isArray(thing)\n}\n\nexport function isEmptyObject(thing: any) {\n  return isObject(thing) && Object.keys(thing).length === 0\n}\n\nexport function hasOwnProperty(obj: any, key: string) {\n  /**\n   * 直接调用`obj.hasOwnProperty`有可能会因为\n   * obj 覆盖了 prototype 上的 hasOwnProperty 而产生错误\n   */\n  return Object.prototype.hasOwnProperty.call(obj, key)\n}\n\n// import { isObject, hasOwnProperty, getSchemaType, guessType } from './utils'\n// import { validateData } from './validator'\n\n// TODO: 应该跟SchemaForm的instance保持一致\nconst defaultInstance = new Ajv()\nexport function validateData(schema: any, data: any) {\n  const valid = defaultInstance.validate(schema, data)\n  return {\n    valid,\n    errors: defaultInstance.errors,\n  }\n}\n\n// function resolveSchema(schema: any, data: any = {}) {}\n\nexport function resolveSchema(schema: Schema, rootSchema = {}, formData = {}) {\n  if (hasOwnProperty(schema, '$ref')) {\n    return resolveReference(schema, rootSchema, formData)\n  } else if (hasOwnProperty(schema, 'dependencies')) {\n    const resolvedSchema = resolveDependencies(schema, rootSchema, formData)\n    return retrieveSchema(resolvedSchema, rootSchema, formData)\n  } else if (hasOwnProperty(schema, 'allOf') && Array.isArray(schema.allOf)) {\n    return {\n      ...schema,\n      allOf: schema.allOf.map((allOfSubschema) =>\n        retrieveSchema(allOfSubschema, rootSchema, formData),\n      ),\n    }\n  } else {\n    // No $ref or dependencies attribute found, returning the original schema.\n    return schema\n  }\n}\n\nexport function retrieveSchema(\n  schema: any,\n  rootSchema = {},\n  formData: any = {},\n): Schema {\n  if (!isObject(schema)) {\n    return {} as Schema\n  }\n  let resolvedSchema = resolveSchema(schema, rootSchema, formData)\n\n  // TODO: allOf and additionalProperties not implemented\n  if ('allOf' in schema) {\n    try {\n      resolvedSchema = mergeAllOf({\n        // TODO: Schema type not suitable\n        ...resolvedSchema,\n        allOf: resolvedSchema.allOf,\n      } as any) as Schema\n    } catch (e) {\n      console.warn('could not merge subschemas in allOf:\\n' + e)\n      const { allOf, ...resolvedSchemaWithoutAllOf } = resolvedSchema\n      return resolvedSchemaWithoutAllOf\n    }\n  }\n  const hasAdditionalProperties =\n    resolvedSchema.hasOwnProperty('additionalProperties') &&\n    resolvedSchema.additionalProperties !== false\n  if (hasAdditionalProperties) {\n    // put formData existing additional properties into schema\n    return stubExistingAdditionalProperties(\n      resolvedSchema,\n      rootSchema,\n      formData,\n    )\n  }\n  return resolvedSchema\n}\n\nexport const ADDITIONAL_PROPERTY_FLAG = '__additional_property'\n// This function will create new \"properties\" items for each key in our formData\nexport function stubExistingAdditionalProperties(\n  schema: Schema,\n  rootSchema: Schema = {},\n  formData: any = {},\n) {\n  // Clone the schema so we don't ruin the consumer's original\n  schema = {\n    ...schema,\n    properties: { ...schema.properties },\n  }\n\n  Object.keys(formData).forEach((key) => {\n    if ((schema as any).properties.hasOwnProperty(key)) {\n      // No need to stub, our schema already has the property\n      return\n    }\n\n    let additionalProperties\n    if (schema.additionalProperties.hasOwnProperty('$ref')) {\n      additionalProperties = retrieveSchema(\n        { $ref: schema.additionalProperties['$ref'] },\n        rootSchema,\n        formData,\n      )\n    } else if (schema.additionalProperties.hasOwnProperty('type')) {\n      additionalProperties = { ...schema.additionalProperties }\n    } else {\n      additionalProperties = { type: guessType(formData[key]) }\n    }\n\n    // The type of our new key should match the additionalProperties value;\n    ;(schema as any).properties[key] = additionalProperties\n    // Set our additional property flag so we know it was dynamically added\n    ;(schema as any).properties[key][ADDITIONAL_PROPERTY_FLAG] = true\n  })\n\n  return schema\n}\n\n// export function processSchema(\n//   schema: any,\n//   rootSchema: any = {},\n//   data: any = {}\n// ): Schema {\n//   if (hasOwnProperty(schema, '$ref')) {\n//     return resolveReference(schema, rootSchema, data)\n//   }\n//   if (hasOwnProperty(schema, 'dependencies')) {\n//     const resolvedSchema = resolveSchema(schema)\n//   }\n// }\n\nfunction resolveReference(schema: any, rootSchema: any, formData: any): Schema {\n  // Retrieve the referenced schema definition.\n  const $refSchema = findSchemaDefinition(schema.$ref, rootSchema)\n  // Drop the $ref property of the source schema.\n  const { $ref, ...localSchema } = schema\n  // Update referenced schema definition with local schema properties.\n  return retrieveSchema({ ...$refSchema, ...localSchema }, rootSchema, formData)\n}\n\nexport function findSchemaDefinition($ref: string, rootSchema = {}): Schema {\n  const origRef = $ref\n  if ($ref.startsWith('#')) {\n    // Decode URI fragment representation.\n    $ref = decodeURIComponent($ref.substring(1))\n  } else {\n    throw new Error(`Could not find a definition for ${origRef}.`)\n  }\n  const current = jsonpointer.get(rootSchema, $ref)\n  if (current === undefined) {\n    throw new Error(`Could not find a definition for ${origRef}.`)\n  }\n  if (hasOwnProperty(current, '$ref')) {\n    // return { ...current, findSchemaDefinition(current.$ref, rootSchema) }  ?\n    return findSchemaDefinition(current.$ref, rootSchema)\n  }\n  return current\n}\n\nfunction resolveDependencies(\n  schema: any,\n  rootSchema: any,\n  formData: any,\n): Schema {\n  // Drop the dependencies from the source schema.\n  let { dependencies = {}, ...resolvedSchema } = schema // eslint-disable-line\n  if ('oneOf' in resolvedSchema) {\n    resolvedSchema =\n      resolvedSchema.oneOf[\n        getMatchingOption(formData, resolvedSchema.oneOf, rootSchema)\n      ]\n  } else if ('anyOf' in resolvedSchema) {\n    resolvedSchema =\n      resolvedSchema.anyOf[\n        getMatchingOption(formData, resolvedSchema.anyOf, rootSchema)\n      ]\n  }\n  return processDependencies(dependencies, resolvedSchema, rootSchema, formData)\n}\nfunction processDependencies(\n  dependencies: any,\n  resolvedSchema: any,\n  rootSchema: any,\n  formData: any,\n): Schema {\n  // Process dependencies updating the local schema properties as appropriate.\n  for (const dependencyKey in dependencies) {\n    // Skip this dependency if its trigger property is not present.\n    if (formData[dependencyKey] === undefined) {\n      continue\n    }\n    // Skip this dependency if it is not included in the schema (such as when dependencyKey is itself a hidden dependency.)\n    if (\n      resolvedSchema.properties &&\n      !(dependencyKey in resolvedSchema.properties)\n    ) {\n      continue\n    }\n    const {\n      [dependencyKey]: dependencyValue,\n      ...remainingDependencies\n    } = dependencies\n    if (Array.isArray(dependencyValue)) {\n      resolvedSchema = withDependentProperties(resolvedSchema, dependencyValue)\n    } else if (isObject(dependencyValue)) {\n      resolvedSchema = withDependentSchema(\n        resolvedSchema,\n        rootSchema,\n        formData,\n        dependencyKey,\n        dependencyValue,\n      )\n    }\n    return processDependencies(\n      remainingDependencies,\n      resolvedSchema,\n      rootSchema,\n      formData,\n    )\n  }\n  return resolvedSchema\n}\n\nfunction withDependentProperties(schema: any, additionallyRequired: any) {\n  if (!additionallyRequired) {\n    return schema\n  }\n  const required = Array.isArray(schema.required)\n    ? Array.from(new Set([...schema.required, ...additionallyRequired]))\n    : additionallyRequired\n  return { ...schema, required: required }\n}\n\nfunction withDependentSchema(\n  schema: any,\n  rootSchema: any,\n  formData: any,\n  dependencyKey: any,\n  dependencyValue: any,\n) {\n  // retrieveSchema\n  const { oneOf, ...dependentSchema } = retrieveSchema(\n    dependencyValue,\n    rootSchema,\n    formData,\n  )\n  schema = mergeSchemas(schema, dependentSchema)\n  // Since it does not contain oneOf, we return the original schema.\n  if (oneOf === undefined) {\n    return schema\n  } else if (!Array.isArray(oneOf)) {\n    throw new Error(`invalid: it is some ${typeof oneOf} instead of an array`)\n  }\n  // Resolve $refs inside oneOf.\n  const resolvedOneOf = oneOf.map((subschema) =>\n    hasOwnProperty(subschema, '$ref')\n      ? resolveReference(subschema, rootSchema, formData)\n      : subschema,\n  )\n  return withExactlyOneSubschema(\n    schema,\n    rootSchema,\n    formData,\n    dependencyKey,\n    resolvedOneOf,\n  )\n}\n\nfunction withExactlyOneSubschema(\n  schema: any,\n  rootSchema: any,\n  formData: any,\n  dependencyKey: any,\n  oneOf: any,\n) {\n  const validSubschemas = oneOf.filter((subschema: any) => {\n    if (!subschema.properties) {\n      return false\n    }\n    const { [dependencyKey]: conditionPropertySchema } = subschema.properties\n    if (conditionPropertySchema) {\n      const conditionSchema = {\n        type: 'object',\n        properties: {\n          [dependencyKey]: conditionPropertySchema,\n        },\n      }\n      // TODO: validate formdata\n      const { errors } = validateData(conditionSchema, formData)\n      return !errors || errors.length === 0\n    }\n  })\n  if (validSubschemas.length !== 1) {\n    console.warn(\n      \"ignoring oneOf in dependencies because there isn't exactly one subschema that is valid\",\n    )\n    return schema\n  }\n  // debugger\n  const subschema = validSubschemas[0]\n  const {\n    [dependencyKey]: conditionPropertySchema,\n    ...dependentSubschema\n  } = subschema.properties\n  const dependentSchema = { ...subschema, properties: dependentSubschema }\n  return mergeSchemas(\n    schema,\n    // retrieveSchema\n    retrieveSchema(dependentSchema, rootSchema, formData),\n  )\n}\n\n// Recursively merge deeply nested schemas.\n// The difference between mergeSchemas and mergeObjects\n// is that mergeSchemas only concats arrays for\n// values under the \"required\" keyword, and when it does,\n// it doesn't include duplicate values.\nexport function mergeSchemas(obj1: any, obj2: any) {\n  const acc = Object.assign({}, obj1) // Prevent mutation of source object.\n  return Object.keys(obj2).reduce((acc, key) => {\n    const left = obj1 ? obj1[key] : {},\n      right = obj2[key]\n    if (obj1 && hasOwnProperty(obj1, key) && isObject(right)) {\n      acc[key] = mergeSchemas(left, right)\n    } else if (\n      obj1 &&\n      obj2 &&\n      (getSchemaType(obj1) === 'object' || getSchemaType(obj2) === 'object') &&\n      key === 'required' &&\n      Array.isArray(left) &&\n      Array.isArray(right)\n    ) {\n      // Don't include duplicate values when merging\n      // \"required\" fields.\n      acc[key] = union(left, right)\n    } else {\n      acc[key] = right\n    }\n    return acc\n  }, acc)\n}\n\n// export function getVJSFConfig(\n//   schema: Schema,\n//   uiSchema: VueJsonSchemaConfig | undefined,\n// ): VueJsonSchemaConfig {\n//   if (uiSchema) return uiSchema\n//   return schema.vjsf || {}\n// }\n\n/* Gets the type of a given schema. */\nexport function getSchemaType(schema: Schema): string | undefined {\n  const { type } = schema\n\n  if (!type && schema.const) {\n    return guessType(schema.const)\n  }\n\n  if (!type && schema.enum) {\n    return 'string'\n  }\n\n  if (!type && (schema.properties || schema.additionalProperties)) {\n    return 'object'\n  }\n\n  const t: any = type\n  if (t instanceof Array && t.length === 2 && t.includes('null')) {\n    return t.find((type) => type !== 'null')\n  }\n\n  return type\n\n  // let { type } = schema\n\n  // if (type) return type\n\n  // if (!type && schema.const) {\n  //   return guessType(schema.const)\n  // }\n\n  // if (!type && schema.enum) {\n  //   // return 'string'\n  //   return guessType(schema.enum[0])\n  // }\n\n  // if (!type && (schema.properties || schema.additionalProperties)) {\n  //   return 'object'\n  // }\n\n  // console.warn('can not guess schema type, just use object', schema)\n  // return 'object'\n\n  // if (type instanceof Array && type.length === 2 && type.includes('null')) {\n  //   return type.find((type) => type !== 'null')\n  // }\n}\n\n// In the case where we have to implicitly create a schema, it is useful to know what type to use\n//  based on the data we are defining\nexport const guessType = function guessType(value: any) {\n  if (Array.isArray(value)) {\n    return 'array'\n  } else if (typeof value === 'string') {\n    return 'string'\n  } else if (value == null) {\n    return 'null'\n  } else if (typeof value === 'boolean') {\n    return 'boolean'\n  } else if (!isNaN(value)) {\n    return 'number'\n  } else if (typeof value === 'object') {\n    return 'object'\n  }\n  // Default to string if we can't figure it out\n  return 'string'\n}\n\nexport function isConstant(schema: Schema) {\n  return (\n    (Array.isArray(schema.enum) && schema.enum.length === 1) ||\n    schema.hasOwnProperty('const')\n  )\n}\n\nexport function isSelect(_schema: any, rootSchema: Schema = {}) {\n  const schema = retrieveSchema(_schema, rootSchema)\n  const altSchemas = schema.oneOf || schema.anyOf\n  if (Array.isArray(schema.enum)) {\n    return true\n  } else if (Array.isArray(altSchemas)) {\n    return altSchemas.every((altSchemas) => isConstant(altSchemas))\n  }\n  return false\n}\n\nexport function isMultiSelect(schema: Schema, rootSchema: Schema = {}) {\n  if (!schema.uniqueItems || !schema.items) {\n    return false\n  }\n  return isSelect(schema.items, rootSchema)\n}\n\n// TODO: change oneOf selected based on data\nexport function getMatchingOption(\n  formData: any,\n  options: Schema[],\n  isValid: (schema: Schema, data: any) => boolean,\n) {\n  for (let i = 0; i < options.length; i++) {\n    const option = options[i]\n\n    // If the schema describes an object then we need to add slightly more\n    // strict matching to the schema, because unless the schema uses the\n    // \"requires\" keyword, an object will match the schema as long as it\n    // doesn't have matching keys with a conflicting type. To do this we use an\n    // \"anyOf\" with an array of requires. This augmentation expresses that the\n    // schema should match if any of the keys in the schema are present on the\n    // object and pass validation.\n    if (option.properties) {\n      // Create an \"anyOf\" schema that requires at least one of the keys in the\n      // \"properties\" object\n      const requiresAnyOf = {\n        anyOf: Object.keys(option.properties).map((key) => ({\n          required: [key],\n        })),\n      }\n\n      let augmentedSchema\n\n      // If the \"anyOf\" keyword already exists, wrap the augmentation in an \"allOf\"\n      if (option.anyOf) {\n        // Create a shallow clone of the option\n        const { ...shallowClone } = option\n\n        if (!shallowClone.allOf) {\n          shallowClone.allOf = []\n        } else {\n          // If \"allOf\" already exists, shallow clone the array\n          shallowClone.allOf = shallowClone.allOf.slice()\n        }\n\n        shallowClone.allOf.push(requiresAnyOf)\n\n        augmentedSchema = shallowClone\n      } else {\n        augmentedSchema = Object.assign({}, option, requiresAnyOf)\n      }\n\n      // Remove the \"required\" field as it's likely that not all fields have\n      // been filled in yet, which will mean that the schema is not valid\n      delete augmentedSchema.required\n\n      if (isValid(augmentedSchema, formData)) {\n        return i\n      }\n    } else if (isValid(options[i], formData)) {\n      return i\n    }\n  }\n  return 0\n}\n\nexport function mergeDefaultsWithFormData(defaults: any, formData: any): any {\n  if (Array.isArray(formData)) {\n    if (!Array.isArray(defaults)) {\n      defaults = []\n    }\n    return formData.map((value, idx) => {\n      if (defaults[idx]) {\n        return mergeDefaultsWithFormData(defaults[idx], value)\n      }\n      return value\n    })\n  } else if (isObject(formData)) {\n    const acc = Object.assign({}, defaults) // Prevent mutation of source object.\n    return Object.keys(formData).reduce((acc, key) => {\n      acc[key] = mergeDefaultsWithFormData(\n        defaults ? defaults[key] : {},\n        formData[key],\n      )\n      return acc\n    }, acc)\n  } else {\n    return formData\n  }\n}\n\nexport function getDefaultFormState(\n  _schema: Schema,\n  formData: any,\n  // rootSchema = {},\n  // includeUndefinedValues = false,\n) {\n  if (!isObject(_schema)) {\n    throw new Error('Invalid schema: ' + _schema)\n  }\n  // const schema = retrieveSchema(_schema, rootSchema, formData)\n  const defaults = _schema.default\n  // TODO: I guess we don't need to get default from children schema\n  // const defaults = computeDefaults(\n  //   schema,\n  //   _schema.default,\n  //   rootSchema,\n  //   formData,\n  //   includeUndefinedValues\n  // );\n  if (typeof formData === 'undefined') {\n    // No form data? Use schema defaults.\n    return defaults\n  }\n  if (isObject(formData) || Array.isArray(formData)) {\n    return mergeDefaultsWithFormData(defaults, formData)\n  }\n  if (formData === 0 || formData === false || formData === '') {\n    return formData\n  }\n  return formData || defaults\n}\n"],"sourceRoot":""}]}