{"remainingRequest":"/Users/junronngcai/Downloads/vue3-json-schema-form/node_modules/babel-loader/lib/index.js!/Users/junronngcai/Downloads/vue3-json-schema-form/node_modules/ts-loader/index.js??ref--14-2!/Users/junronngcai/Downloads/vue3-json-schema-form/node_modules/eslint-loader/index.js??ref--13-0!/Users/junronngcai/Downloads/vue3-json-schema-form/lib/validator.ts","dependencies":[{"path":"/Users/junronngcai/Downloads/vue3-json-schema-form/lib/validator.ts","mtime":1608690307193},{"path":"/Users/junronngcai/Downloads/vue3-json-schema-form/node_modules/cache-loader/dist/cjs.js","mtime":1607437832202},{"path":"/Users/junronngcai/Downloads/vue3-json-schema-form/node_modules/babel-loader/lib/index.js","mtime":1608516392415},{"path":"/Users/junronngcai/Downloads/vue3-json-schema-form/node_modules/ts-loader/index.js","mtime":1608516394013},{"path":"/Users/junronngcai/Downloads/vue3-json-schema-form/node_modules/eslint-loader/index.js","mtime":1607437999134}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuY29uY2F0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkubWFwIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkucmVkdWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXkuc2xpY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5hcnJheS5zcGxpY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5vYmplY3Qua2V5cyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnJlZmxlY3QuZ2V0IjsKaW1wb3J0IF90b0NvbnN1bWFibGVBcnJheSBmcm9tICIvVXNlcnMvanVucm9ubmdjYWkvRG93bmxvYWRzL3Z1ZTMtanNvbi1zY2hlbWEtZm9ybS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vdG9Db25zdW1hYmxlQXJyYXkiOwppbXBvcnQgInJlZ2VuZXJhdG9yLXJ1bnRpbWUvcnVudGltZSI7CmltcG9ydCBfYXN5bmNUb0dlbmVyYXRvciBmcm9tICIvVXNlcnMvanVucm9ubmdjYWkvRG93bmxvYWRzL3Z1ZTMtanNvbi1zY2hlbWEtZm9ybS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vYXN5bmNUb0dlbmVyYXRvciI7CmltcG9ydCBfY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciBmcm9tICIvVXNlcnMvanVucm9ubmdjYWkvRG93bmxvYWRzL3Z1ZTMtanNvbi1zY2hlbWEtZm9ybS9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlRm9yT2ZJdGVyYXRvckhlbHBlciI7CmltcG9ydCB0b1BhdGggZnJvbSAnbG9kYXNoLnRvcGF0aCc7Cgp2YXIgaTE4biA9IHJlcXVpcmUoJ2Fqdi1pMThuJyk7IC8vIGVzbGludC1kaXNhYmxlLWxpbmUKCgppbXBvcnQgeyBpc09iamVjdCB9IGZyb20gJy4vdXRpbHMnOwoKZnVuY3Rpb24gdG9FcnJvclNjaGVtYShlcnJvcnMpIHsKICBpZiAoZXJyb3JzLmxlbmd0aCA8IDEpIHJldHVybiB7fTsKICByZXR1cm4gZXJyb3JzLnJlZHVjZShmdW5jdGlvbiAoZXJyb3JTY2hlbWEsIGVycm9yKSB7CiAgICB2YXIgcHJvcGVydHkgPSBlcnJvci5wcm9wZXJ0eSwKICAgICAgICBtZXNzYWdlID0gZXJyb3IubWVzc2FnZTsKICAgIHZhciBwYXRoID0gdG9QYXRoKHByb3BlcnR5KTsgLy8gL29iai9hIC0+IFtvYmosIGFdCgogICAgdmFyIHBhcmVudCA9IGVycm9yU2NoZW1hOyAvLyBJZiB0aGUgcHJvcGVydHkgaXMgYXQgdGhlIHJvb3QgKC5sZXZlbDEpIHRoZW4gdG9QYXRoIGNyZWF0ZXMKICAgIC8vIGFuIGVtcHR5IGFycmF5IGVsZW1lbnQgYXQgdGhlIGZpcnN0IGluZGV4LiBSZW1vdmUgaXQuCgogICAgaWYgKHBhdGgubGVuZ3RoID4gMCAmJiBwYXRoWzBdID09PSAnJykgewogICAgICBwYXRoLnNwbGljZSgwLCAxKTsKICAgIH0gLy8gewogICAgLy8gICBvYmo6IHsKICAgIC8vICAgICBhOiB7fQogICAgLy8gICB9CiAgICAvLyB9IC8vIC9vYmovYQoKCiAgICB2YXIgX2l0ZXJhdG9yID0gX2NyZWF0ZUZvck9mSXRlcmF0b3JIZWxwZXIocGF0aC5zbGljZSgwKSksCiAgICAgICAgX3N0ZXA7CgogICAgdHJ5IHsKICAgICAgZm9yIChfaXRlcmF0b3IucygpOyAhKF9zdGVwID0gX2l0ZXJhdG9yLm4oKSkuZG9uZTspIHsKICAgICAgICB2YXIgc2VnbWVudCA9IF9zdGVwLnZhbHVlOwoKICAgICAgICBpZiAoIShzZWdtZW50IGluIHBhcmVudCkpIHsKICAgICAgICAgIDsKICAgICAgICAgIHBhcmVudFtzZWdtZW50XSA9IHt9OwogICAgICAgIH0KCiAgICAgICAgcGFyZW50ID0gcGFyZW50W3NlZ21lbnRdOwogICAgICB9CiAgICB9IGNhdGNoIChlcnIpIHsKICAgICAgX2l0ZXJhdG9yLmUoZXJyKTsKICAgIH0gZmluYWxseSB7CiAgICAgIF9pdGVyYXRvci5mKCk7CiAgICB9CgogICAgaWYgKEFycmF5LmlzQXJyYXkocGFyZW50Ll9fZXJyb3JzKSkgewogICAgICAvLyBXZSBzdG9yZSB0aGUgbGlzdCBvZiBlcnJvcnMgZm9yIHRoaXMgbm9kZSBpbiBhIHByb3BlcnR5IG5hbWVkIF9fZXJyb3JzCiAgICAgIC8vIHRvIGF2b2lkIG5hbWUgY29sbGlzaW9uIHdpdGggYSBwb3NzaWJsZSBzdWIgc2NoZW1hIGZpZWxkIG5hbWVkCiAgICAgIC8vICJlcnJvcnMiIChzZWUgYHZhbGlkYXRlLmNyZWF0ZUVycm9ySGFuZGxlcmApLgogICAgICBwYXJlbnQuX19lcnJvcnMgPSBwYXJlbnQuX19lcnJvcnMuY29uY2F0KG1lc3NhZ2UgfHwgJycpOwogICAgfSBlbHNlIHsKICAgICAgaWYgKG1lc3NhZ2UpIHsKICAgICAgICBwYXJlbnQuX19lcnJvcnMgPSBbbWVzc2FnZV07CiAgICAgIH0KICAgIH0KCiAgICByZXR1cm4gZXJyb3JTY2hlbWE7CiAgfSwge30pOwp9CgpmdW5jdGlvbiB0cmFuc2Zvcm1FcnJvcnMoZXJyb3JzKSB7CiAgaWYgKGVycm9ycyA9PT0gbnVsbCB8fCBlcnJvcnMgPT09IHVuZGVmaW5lZCkgcmV0dXJuIFtdOwogIHJldHVybiBlcnJvcnMubWFwKGZ1bmN0aW9uIChfcmVmKSB7CiAgICB2YXIgbWVzc2FnZSA9IF9yZWYubWVzc2FnZSwKICAgICAgICBkYXRhUGF0aCA9IF9yZWYuZGF0YVBhdGgsCiAgICAgICAga2V5d29yZCA9IF9yZWYua2V5d29yZCwKICAgICAgICBwYXJhbXMgPSBfcmVmLnBhcmFtcywKICAgICAgICBzY2hlbWFQYXRoID0gX3JlZi5zY2hlbWFQYXRoOwogICAgcmV0dXJuIHsKICAgICAgbmFtZToga2V5d29yZCwKICAgICAgcHJvcGVydHk6ICIiLmNvbmNhdChkYXRhUGF0aCksCiAgICAgIG1lc3NhZ2U6IG1lc3NhZ2UsCiAgICAgIHBhcmFtczogcGFyYW1zLAogICAgICBzY2hlbWFQYXRoOiBzY2hlbWFQYXRoCiAgICB9OwogIH0pOwp9CgpleHBvcnQgZnVuY3Rpb24gdmFsaWRhdGVGb3JtRGF0YShfeCwgX3gyLCBfeDMpIHsKICByZXR1cm4gX3ZhbGlkYXRlRm9ybURhdGEuYXBwbHkodGhpcywgYXJndW1lbnRzKTsKfQoKZnVuY3Rpb24gX3ZhbGlkYXRlRm9ybURhdGEoKSB7CiAgX3ZhbGlkYXRlRm9ybURhdGEgPSBfYXN5bmNUb0dlbmVyYXRvciggLyojX19QVVJFX18qL3JlZ2VuZXJhdG9yUnVudGltZS5tYXJrKGZ1bmN0aW9uIF9jYWxsZWUodmFsaWRhdG9yLCBmb3JtRGF0YSwgc2NoZW1hKSB7CiAgICB2YXIgbG9jYWxlLAogICAgICAgIGN1c3RvbVZhbGlkYXRlLAogICAgICAgIHZhbGlkYXRpb25FcnJvciwKICAgICAgICBlcnJvcnMsCiAgICAgICAgZXJyb3JTY2hlbWEsCiAgICAgICAgcHJveHksCiAgICAgICAgbmV3RXJyb3JTY2hlbWEsCiAgICAgICAgX2FyZ3MgPSBhcmd1bWVudHM7CiAgICByZXR1cm4gcmVnZW5lcmF0b3JSdW50aW1lLndyYXAoZnVuY3Rpb24gX2NhbGxlZSQoX2NvbnRleHQpIHsKICAgICAgd2hpbGUgKDEpIHsKICAgICAgICBzd2l0Y2ggKF9jb250ZXh0LnByZXYgPSBfY29udGV4dC5uZXh0KSB7CiAgICAgICAgICBjYXNlIDA6CiAgICAgICAgICAgIGxvY2FsZSA9IF9hcmdzLmxlbmd0aCA+IDMgJiYgX2FyZ3NbM10gIT09IHVuZGVmaW5lZCA/IF9hcmdzWzNdIDogJ3poJzsKICAgICAgICAgICAgY3VzdG9tVmFsaWRhdGUgPSBfYXJncy5sZW5ndGggPiA0ID8gX2FyZ3NbNF0gOiB1bmRlZmluZWQ7CiAgICAgICAgICAgIHZhbGlkYXRpb25FcnJvciA9IG51bGw7CgogICAgICAgICAgICB0cnkgewogICAgICAgICAgICAgIHZhbGlkYXRvci52YWxpZGF0ZShzY2hlbWEsIGZvcm1EYXRhKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgICAgICAgdmFsaWRhdGlvbkVycm9yID0gZXJyOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpMThuW2xvY2FsZV0odmFsaWRhdG9yLmVycm9ycyk7CiAgICAgICAgICAgIGVycm9ycyA9IHRyYW5zZm9ybUVycm9ycyh2YWxpZGF0b3IuZXJyb3JzKTsKCiAgICAgICAgICAgIGlmICh2YWxpZGF0aW9uRXJyb3IpIHsKICAgICAgICAgICAgICBlcnJvcnMgPSBbXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KGVycm9ycyksIFt7CiAgICAgICAgICAgICAgICBtZXNzYWdlOiB2YWxpZGF0aW9uRXJyb3IubWVzc2FnZQogICAgICAgICAgICAgIH1dKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZXJyb3JTY2hlbWEgPSB0b0Vycm9yU2NoZW1hKGVycm9ycyk7CgogICAgICAgICAgICBpZiAoY3VzdG9tVmFsaWRhdGUpIHsKICAgICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTA7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICBlcnJvcnM6IGVycm9ycywKICAgICAgICAgICAgICBlcnJvclNjaGVtYTogZXJyb3JTY2hlbWEsCiAgICAgICAgICAgICAgdmFsaWQ6IGVycm9ycy5sZW5ndGggPT09IDAKICAgICAgICAgICAgfSk7CgogICAgICAgICAgY2FzZSAxMDoKICAgICAgICAgICAgLyoqCiAgICAgICAgICAgICAqIHsKICAgICAgICAgICAgICogICAgb2JqOiB7CiAgICAgICAgICAgICAqICAgICAgIGE6IHsgYjogc3RyIH0KICAgICAgICAgICAgICogICAgICAgX19lcnJvcnM6IFtdCiAgICAgICAgICAgICAqICAgIH0KICAgICAgICAgICAgICogfQogICAgICAgICAgICAgKgogICAgICAgICAgICAgKiByYXcub2JqLmEKICAgICAgICAgICAgICovCiAgICAgICAgICAgIHByb3h5ID0gY3JlYXRlRXJyb3JQcm94eSgpOwogICAgICAgICAgICBfY29udGV4dC5uZXh0ID0gMTM7CiAgICAgICAgICAgIHJldHVybiBjdXN0b21WYWxpZGF0ZShmb3JtRGF0YSwgcHJveHkpOwoKICAgICAgICAgIGNhc2UgMTM6CiAgICAgICAgICAgIG5ld0Vycm9yU2NoZW1hID0gbWVyZ2VPYmplY3RzKGVycm9yU2NoZW1hLCBwcm94eSwgdHJ1ZSk7CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5hYnJ1cHQoInJldHVybiIsIHsKICAgICAgICAgICAgICBlcnJvcnM6IGVycm9ycywKICAgICAgICAgICAgICBlcnJvclNjaGVtYTogbmV3RXJyb3JTY2hlbWEsCiAgICAgICAgICAgICAgdmFsaWQ6IGVycm9ycy5sZW5ndGggPT09IDAKICAgICAgICAgICAgfSk7CgogICAgICAgICAgY2FzZSAxNToKICAgICAgICAgIGNhc2UgImVuZCI6CiAgICAgICAgICAgIHJldHVybiBfY29udGV4dC5zdG9wKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9LCBfY2FsbGVlKTsKICB9KSk7CiAgcmV0dXJuIF92YWxpZGF0ZUZvcm1EYXRhLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7Cn0KCmZ1bmN0aW9uIGNyZWF0ZUVycm9yUHJveHkoKSB7CiAgdmFyIHJhdyA9IHt9OwogIHJldHVybiBuZXcgUHJveHkocmF3LCB7CiAgICBnZXQ6IGZ1bmN0aW9uIGdldCh0YXJnZXQsIGtleSwgcmVjaXZlcikgewogICAgICBpZiAoa2V5ID09PSAnYWRkRXJyb3InKSB7CiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChtc2cpIHsKICAgICAgICAgIHZhciBfX2Vycm9ycyA9IFJlZmxlY3QuZ2V0KHRhcmdldCwgJ19fZXJyb3JzJywgcmVjaXZlcik7CgogICAgICAgICAgaWYgKF9fZXJyb3JzICYmIEFycmF5LmlzQXJyYXkoX19lcnJvcnMpKSB7CiAgICAgICAgICAgIF9fZXJyb3JzLnB1c2gobXNnKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIDsKICAgICAgICAgICAgdGFyZ2V0Ll9fZXJyb3JzID0gW21zZ107CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfQoKICAgICAgdmFyIHJlcyA9IFJlZmxlY3QuZ2V0KHRhcmdldCwga2V5LCByZWNpdmVyKTsKCiAgICAgIGlmIChyZXMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHZhciBwID0gY3JlYXRlRXJyb3JQcm94eSgpOwogICAgICAgIHRhcmdldFtrZXldID0gcDsKICAgICAgICByZXR1cm4gcDsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlczsKICAgIH0KICB9KTsKfQoKZXhwb3J0IGZ1bmN0aW9uIG1lcmdlT2JqZWN0cyhvYmoxLCBvYmoyKSB7CiAgdmFyIGNvbmNhdEFycmF5cyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogZmFsc2U7CiAgLy8gUmVjdXJzaXZlbHkgbWVyZ2UgZGVlcGx5IG5lc3RlZCBvYmplY3RzLgogIHZhciBhY2MgPSBPYmplY3QuYXNzaWduKHt9LCBvYmoxKTsgLy8gUHJldmVudCBtdXRhdGlvbiBvZiBzb3VyY2Ugb2JqZWN0LgoKICByZXR1cm4gT2JqZWN0LmtleXMob2JqMikucmVkdWNlKGZ1bmN0aW9uIChhY2MsIGtleSkgewogICAgdmFyIGxlZnQgPSBvYmoxID8gb2JqMVtrZXldIDoge30sCiAgICAgICAgcmlnaHQgPSBvYmoyW2tleV07CgogICAgaWYgKG9iajEgJiYgb2JqMS5oYXNPd25Qcm9wZXJ0eShrZXkpICYmIGlzT2JqZWN0KHJpZ2h0KSkgewogICAgICBhY2Nba2V5XSA9IG1lcmdlT2JqZWN0cyhsZWZ0LCByaWdodCwgY29uY2F0QXJyYXlzKTsKICAgIH0gZWxzZSBpZiAoY29uY2F0QXJyYXlzICYmIEFycmF5LmlzQXJyYXkobGVmdCkgJiYgQXJyYXkuaXNBcnJheShyaWdodCkpIHsKICAgICAgYWNjW2tleV0gPSBsZWZ0LmNvbmNhdChyaWdodCk7CiAgICB9IGVsc2UgewogICAgICBhY2Nba2V5XSA9IHJpZ2h0OwogICAgfQoKICAgIHJldHVybiBhY2M7CiAgfSwgYWNjKTsKfQ=="},{"version":3,"sources":["/Users/junronngcai/Downloads/vue3-json-schema-form/node_modules/eslint-loader/index.js??ref--13-0!/Users/junronngcai/Downloads/vue3-json-schema-form/lib/validator.ts"],"names":[],"mappings":"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","sourcesContent":["import Ajv from 'ajv'\nimport toPath from 'lodash.topath'\nconst i18n = require('ajv-i18n') // eslint-disable-line\n\nimport { Schema } from './types'\nimport { isObject } from './utils'\n\ninterface TransformedErrorObject {\n  name: string\n  property: string\n  message: string | undefined\n  params: Ajv.ErrorParameters\n  schemaPath: string\n}\n\ninterface ErrorSchemaObject {\n  [level: string]: ErrorSchema\n}\n\nexport type ErrorSchema = ErrorSchemaObject & {\n  __errors?: string[]\n}\nfunction toErrorSchema(errors: TransformedErrorObject[]) {\n  if (errors.length < 1) return {}\n\n  return errors.reduce((errorSchema, error) => {\n    const { property, message } = error\n    const path = toPath(property) // /obj/a -> [obj, a]\n    let parent = errorSchema\n\n    // If the property is at the root (.level1) then toPath creates\n    // an empty array element at the first index. Remove it.\n    if (path.length > 0 && path[0] === '') {\n      path.splice(0, 1)\n    }\n\n    // {\n    //   obj: {\n    //     a: {}\n    //   }\n    // } // /obj/a\n    for (const segment of path.slice(0)) {\n      if (!(segment in parent)) {\n        ;(parent as any)[segment] = {}\n      }\n      parent = parent[segment]\n    }\n\n    if (Array.isArray(parent.__errors)) {\n      // We store the list of errors for this node in a property named __errors\n      // to avoid name collision with a possible sub schema field named\n      // \"errors\" (see `validate.createErrorHandler`).\n      parent.__errors = parent.__errors.concat(message || '')\n    } else {\n      if (message) {\n        parent.__errors = [message]\n      }\n    }\n    return errorSchema\n  }, {} as ErrorSchema)\n}\n\nfunction transformErrors(\n  errors: Ajv.ErrorObject[] | null | undefined,\n): TransformedErrorObject[] {\n  if (errors === null || errors === undefined) return []\n\n  return errors.map(({ message, dataPath, keyword, params, schemaPath }) => {\n    return {\n      name: keyword,\n      property: `${dataPath}`,\n      message,\n      params,\n      schemaPath,\n    }\n  })\n}\n\nexport async function validateFormData(\n  validator: Ajv.Ajv,\n  formData: any,\n  schema: Schema,\n  locale = 'zh',\n  customValidate?: (data: any, errors: any) => void,\n) {\n  let validationError = null\n  try {\n    validator.validate(schema, formData)\n  } catch (err) {\n    validationError = err\n  }\n\n  i18n[locale](validator.errors)\n  let errors = transformErrors(validator.errors)\n\n  if (validationError) {\n    errors = [\n      ...errors,\n      {\n        message: validationError.message,\n      } as TransformedErrorObject,\n    ]\n  }\n\n  const errorSchema = toErrorSchema(errors)\n  if (!customValidate) {\n    return {\n      errors,\n      errorSchema,\n      valid: errors.length === 0,\n    }\n  }\n\n  /**\n   * {\n   *    obj: {\n   *       a: { b: str }\n   *       __errors: []\n   *    }\n   * }\n   *\n   * raw.obj.a\n   */\n  const proxy = createErrorProxy()\n  await customValidate(formData, proxy)\n  const newErrorSchema = mergeObjects(errorSchema, proxy, true)\n\n  return {\n    errors,\n    errorSchema: newErrorSchema,\n    valid: errors.length === 0,\n  }\n}\n\nfunction createErrorProxy() {\n  const raw = {}\n  return new Proxy(raw, {\n    get(target, key, reciver) {\n      if (key === 'addError') {\n        return (msg: string) => {\n          const __errors = Reflect.get(target, '__errors', reciver)\n          if (__errors && Array.isArray(__errors)) {\n            __errors.push(msg)\n          } else {\n            ;(target as any).__errors = [msg]\n          }\n        }\n      }\n      const res = Reflect.get(target, key, reciver)\n      if (res === undefined) {\n        const p: any = createErrorProxy()\n        ;(target as any)[key] = p\n        return p\n      }\n\n      return res\n    },\n  })\n}\n\nexport function mergeObjects(obj1: any, obj2: any, concatArrays = false) {\n  // Recursively merge deeply nested objects.\n  const acc = Object.assign({}, obj1) // Prevent mutation of source object.\n  return Object.keys(obj2).reduce((acc, key) => {\n    const left = obj1 ? obj1[key] : {},\n      right = obj2[key]\n    if (obj1 && obj1.hasOwnProperty(key) && isObject(right)) {\n      acc[key] = mergeObjects(left, right, concatArrays)\n    } else if (concatArrays && Array.isArray(left) && Array.isArray(right)) {\n      acc[key] = left.concat(right)\n    } else {\n      acc[key] = right\n    }\n    return acc\n  }, acc)\n}\n"],"sourceRoot":""}]}